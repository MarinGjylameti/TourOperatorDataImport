<!DOCTYPE html>
<html>
<head>
    <title>Tour Operator File Upload</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/6.0.1/signalr.min.js"></script>
</head>
<body>
<h1>File Upload with Progress</h1>

<div>
    <h3>Progress:</h3>
    <div id="progress" style="border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto;"></div>
</div>

<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/progressHub")
        .configureLogging(signalR.LogLevel.Information) 
        .build();

    connection.on("ReceiveProgress", (message) => {
        console.log('Progress:', message);
        const progressDiv = document.getElementById('progress');
        const timestamp = new Date().toLocaleTimeString();
        progressDiv.innerHTML += `[${timestamp}] ${message}<br>`;
        progressDiv.scrollTop = progressDiv.scrollHeight; // Auto-scroll to bottom
    });

    connection.on("Connected", (connectionId) => {
        console.log('Connected with ID:', connectionId);
        document.getElementById('progress').innerHTML += `✅ Connected to SignalR (ID: ${connectionId})<br>`;
        localStorage.setItem('connectionId', connectionId);
    });

    connection.onclose((error) => {
        console.error('SignalR connection closed:', error);
        document.getElementById('progress').innerHTML += `❌ SignalR connection lost. Trying to reconnect...<br>`;
    });

    async function startConnection() {
        try {
            await connection.start();
            console.log('SignalR Connected');
            document.getElementById('progress').innerHTML += '🔗 Connecting to SignalR...<br>';
        } catch (err) {
            console.error('SignalR Connection Error:', err);
            document.getElementById('progress').innerHTML += `❌ Failed to connect: ${err.message}<br>`;
            // Retry after 5 seconds
            setTimeout(() => startConnection(), 5000);
        }
    }

    startConnection();

    // Add event listener for file input change
    document.getElementById('fileInput').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            document.getElementById('progress').innerHTML += `📄 Selected file: ${e.target.files[0].name}<br>`;
        }
    });
</script>
</body>
</html>